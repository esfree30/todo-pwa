<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ í•  ì¼</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#7bcfa3" />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(180deg, #e9f7f0 0%, #f6fbf9 100%);
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      width: 100%;
      max-width: 420px;
      background: #fff;
      border-radius: 26px;
      padding: 20px 18px 22px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.08);
    }

    h1 { text-align:center; margin:6px 0 10px; }
    .counter { text-align:center; font-size:13px; color:#5a8f77; margin-bottom:12px; }

    .date-strip { display:flex; gap:8px; overflow-x:auto; padding:6px 2px 14px; }
    .date-item {
      min-width:60px; padding:10px 6px 8px;
      border-radius:16px;
      background:#f4faf7;
      border:1px solid #d9efe4;
      text-align:center;
      cursor:pointer;
      font-size:12px;
      color:#3f7f5f;
    }
    .date-item.active { background:#7bcfa3; color:#fff; }
    .date-item.today { outline:2px solid rgba(76,175,143,.5); }
    .date-item .num { font-size:17px; font-weight:700; }
    .date-item .dot {
      width:6px;height:6px;border-radius:50%;
      margin:4px auto 0;background:#4caf8f;
    }
    .date-item .dot.done { background:#b9d8cc; }

    #openCalendarBtn {
      display:block; margin:6px auto 14px;
      padding:9px 16px;
      border:none; border-radius:999px;
      background:#e3f4ec; color:#2f7d5b;
    }

    .input-row { display:flex; flex-direction:column; gap:10px; margin-bottom:12px; }

    input, select {
      padding:14px 16px;
      border-radius:999px;
      border:1px solid #d4eadf;
      font-size:15px;
      background:#fbfefd;
    }

    button {
      padding:13px 16px;
      border:none;
      border-radius:999px;
      background:linear-gradient(135deg,#7bcfa3,#6bc69a);
      color:white;
      font-weight:600;
      cursor:pointer;
    }

    .clear-completed {
      width:100%;
      margin-bottom:14px;
      background:#e9f6ef;
      color:#3f7f5f;
    }

    ul { list-style:none; padding:0; margin:0; }

    li {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 10px;
      border-bottom:1px solid #edf4f1;
    }

    .task { display:flex; align-items:center; gap:10px; flex:1; }
    .completed span { text-decoration:line-through; color:#aab7b1; }

    .star-btn { background:none; border:none; font-size:20px; color:#f2c94c; }
    .delete-btn { background:none; border:none; font-size:18px; color:#ff6b6b; }

    .calendar-overlay {
      position:fixed; inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:999;
    }

    .calendar-modal {
      background:#fff;
      border-radius:22px;
      padding:18px;
      width:92%;
      max-width:360px;
    }

    .calendar-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }

    .calendar-grid {
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:6px;
      text-align:center;
    }

    .calendar-cell {
      padding:10px 0;
      border-radius:12px;
      cursor:pointer;
    }
    .calendar-cell.today { outline:2px solid #7bcfa3; }
    .calendar-cell.selected { background:#7bcfa3; color:#fff; }

    .calendar-cell .dot {
      width:6px;height:6px;margin:4px auto 0;
      border-radius:50%;
      background:#4caf8f;
    }
    .calendar-cell .dot.done { background:#b8d7cb; }
  </style>
</head>

<body>

<div class="calendar-overlay" id="calendarOverlay">
  <div class="calendar-modal">
    <div class="calendar-header">
      <button id="prevMonth">â—€</button>
      <div id="calendarTitle"></div>
      <button id="nextMonth">â–¶</button>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
  </div>
</div>

<div class="app">
  <h1>ğŸ“ ì˜¤ëŠ˜ì˜ í•  ì¼</h1>

  <div id="summaryCard" style="margin:12px 0 14px;padding:14px 16px;border-radius:18px;background:linear-gradient(135deg,#e8f7f0,#f6fbf9);box-shadow:0 6px 16px rgba(0,0,0,.06);">
    <div style="font-size:14px;color:#3f7f5f;font-weight:600;">ğŸ“… ì˜¤ëŠ˜</div>
    <div id="summaryDate" style="font-size:13px;color:#6a8a7a;margin-top:2px;"></div>
    <div style="margin-top:10px;font-size:15px;">â³ ë‚¨ì€ í•  ì¼ <b id="summaryRemain">0</b>ê°œ</div>
    <div id="summaryImportant" style="margin-top:6px;font-size:14px;color:#2f7d5b;"></div>
  </div>

  <div class="counter" id="counter"></div>

  <div id="dateStrip" class="date-strip"></div>
  <button id="openCalendarBtn">ğŸ“… ë‹¬ë ¥ ì „ì²´ ë³´ê¸°</button>

  <div class="input-row">
    <input id="todoInput" type="text" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" />
    <select id="repeatSelect">
      <option value="none">ë°˜ë³µ ì—†ìŒ</option>
      <option value="daily">ë§¤ì¼</option>
      <option value="weekly">ë§¤ì£¼</option>
    </select>
    <button id="addBtn">ì¶”ê°€</button>
  </div>

  <button class="clear-completed" id="clearCompletedBtn">ì™„ë£Œëœ í•­ëª© ëª¨ë‘ ì‚­ì œ</button>
  <ul id="todoList"></ul>
</div>

<script>
/* ================= ìœ í‹¸ ================= */
function pad(n){ return String(n).padStart(2,'0'); }
function formatDateLocal(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
function parseDateLocal(str){ const [y,m,d]=str.split('-').map(Number); return new Date(y,m-1,d); }

const STORAGE_KEY = 'todos_v3';
let todos = [];
let selectedDate = formatDateLocal(new Date());
let calendarMonth = new Date();

const dateStrip = document.getElementById('dateStrip');
const list = document.getElementById('todoList');
const counter = document.getElementById('counter');
const input = document.getElementById('todoInput');
const repeatSelect = document.getElementById('repeatSelect');

/* ---------- ì €ì¥ ---------- */
function saveTodos(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }
function loadTodos(){
  try { todos = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch { todos = []; }
}

/* ---------- ë‚ ì§œ ë§¤ì¹­ ---------- */
function matchesDate(todo, dateStr){
  if(todo.repeat === 'none') return todo.date === dateStr;

  const base = parseDateLocal(todo.date);
  const cur  = parseDateLocal(dateStr);

  if(cur < base) return false;
  if(todo.repeat === 'daily') return true;
  if(todo.repeat === 'weekly') return base.getDay() === cur.getDay();

  return false;
}

/* ---------- ì™„ë£Œ ìƒíƒœ (ë‚ ì§œë³„) ---------- */
function isCompletedOnDate(todo, dateStr){
  if(!todo.completedDates) return false;
  return todo.completedDates.includes(dateStr);
}

function setCompletedOnDate(todo, dateStr, value){
  if(!todo.completedDates) todo.completedDates = [];

  if(value){
    if(!todo.completedDates.includes(dateStr))
      todo.completedDates.push(dateStr);
  } else {
    todo.completedDates = todo.completedDates.filter(d => d !== dateStr);
  }
}

/* ---------- ìš”ì•½ ---------- */
function updateSummary(){
  const target = selectedDate; // âœ… ì„ íƒí•œ ë‚ ì§œë¡œ ì—°ë™
  const isToday = target === formatDateLocal(new Date());

  const targetTodos = todos.filter(t => matchesDate(t, target));
  const remaining = targetTodos.filter(t => !isCompletedOnDate(t, target));
  const important = targetTodos.find(t => t.important && !isCompletedOnDate(t, target));

  // ë‚ ì§œ í‘œì‹œ(ì„ íƒí•œ ë‚ ì§œ ê¸°ì¤€)
  const dateObj = parseDateLocal(target);
  document.getElementById('summaryDate').textContent = dateObj.toLocaleDateString('ko-KR', {
    month:'long', day:'numeric', weekday:'short'
  });

  // ì œëª©ë„ ì˜¤ëŠ˜/ì„ íƒí•œ ë‚ ì§œ ëŠë‚Œìœ¼ë¡œ(ì›í•˜ë©´ ì‚­ì œ ê°€ëŠ¥)
  const titleEl = document.querySelector('#summaryCard > div:first-child');
  if (titleEl) titleEl.textContent = isToday ? 'ğŸ“… ì˜¤ëŠ˜' : 'ğŸ“… ì„ íƒí•œ ë‚ ì§œ';

  document.getElementById('summaryRemain').textContent = remaining.length;

  const box = document.getElementById('summaryImportant');
  if (important) box.textContent = `â­ ê°€ì¥ ì¤‘ìš”í•œ ì¼: ${important.text}`;
  else if (remaining.length) box.textContent = 'í•´ì•¼ í•  ì¼ì´ ìˆì–´ìš” ğŸ‘';
  else box.textContent = 'í•  ì¼ ëª¨ë‘ ì™„ë£Œí–ˆì–´ìš” ğŸ‰';
}


/* ---------- ë‚ ì§œ ìŠ¤íŠ¸ë¦½ ---------- */
function renderDateStrip(){
  dateStrip.innerHTML='';
  for(let i=-3;i<=3;i++){
    const d = parseDateLocal(selectedDate);
    d.setDate(d.getDate()+i);
    const val = formatDateLocal(d);

    const item = document.createElement('div');
    item.className = 'date-item'
      + (val===selectedDate?' active':'')
      + (val===formatDateLocal(new Date())?' today':'');

    const day = document.createElement('div');
    day.textContent = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
    const num = document.createElement('div');
    num.className='num';
    num.textContent=d.getDate();

    item.append(day,num);

    const related = todos.filter(t=>matchesDate(t,val));
    if(related.length){
      const dot=document.createElement('div');
      dot.className='dot'+(related.every(t=>isCompletedOnDate(t,val))?' done':'');
      item.appendChild(dot);
    }

    item.onclick=()=>{ selectedDate=val; renderDateStrip(); render(); };
    dateStrip.appendChild(item);
  }
}

/* ---------- ì›” ë‹¬ë ¥ ---------- */
function renderMonthCalendar(){
  const grid=document.getElementById('calendarGrid');
  const title=document.getElementById('calendarTitle');
  grid.innerHTML='';

  const y=calendarMonth.getFullYear();
  const m=calendarMonth.getMonth();
  title.textContent=`${y}ë…„ ${m+1}ì›”`;

  const first=new Date(y,m,1).getDay();
  const last=new Date(y,m+1,0).getDate();

  for(let i=0;i<first;i++) grid.appendChild(document.createElement('div'));

  for(let d=1;d<=last;d++){
    const dateObj=new Date(y,m,d);
    const dateStr=formatDateLocal(dateObj);

    const cell=document.createElement('div');
    cell.className='calendar-cell';
    cell.textContent=d;

    if(dateStr===formatDateLocal(new Date())) cell.classList.add('today');
    if(dateStr===selectedDate) cell.classList.add('selected');

    const related=todos.filter(t=>matchesDate(t,dateStr));
    if(related.length){
      const dot=document.createElement('div');
      dot.className='dot'+(related.every(t=>isCompletedOnDate(t,dateStr))?' done':'');
      cell.appendChild(dot);
    }

    cell.onclick=()=>{
      selectedDate=dateStr;
      document.getElementById('calendarOverlay').style.display='none';
      renderDateStrip();
      render();
    };

    grid.appendChild(cell);
  }
}

/* ---------- ë Œë” ---------- */
function render(){
  updateSummary();
  list.innerHTML='';

  const today=formatDateLocal(new Date());
  let visible=todos.filter(t=>matchesDate(t,selectedDate));

  if(selectedDate===today){
    visible=[...visible].sort(
      (a,b)=>isCompletedOnDate(a,selectedDate)-isCompletedOnDate(b,selectedDate)
    );
  }

  visible.forEach(t=>{
    const li=document.createElement('li');

    if(isCompletedOnDate(t,selectedDate)) li.classList.add('completed');

    if(selectedDate===today){
      li.style.background='#f3fbf7';
      li.style.borderRadius='12px';
      li.style.marginBottom='4px';
    }

    const task=document.createElement('div');
    task.className='task';

    const cb=document.createElement('input');
    cb.type='checkbox';
    cb.checked=isCompletedOnDate(t,selectedDate);
    cb.onchange=()=>{
      setCompletedOnDate(t,selectedDate,cb.checked);
      saveTodos();
      render();
    };

    const span=document.createElement('span');
    span.textContent=t.text;

    task.append(cb,span);

    const star=document.createElement('button');
    star.className='star-btn';
    star.textContent=t.important?'â˜…':'â˜†';
    star.onclick=()=>{ t.important=!t.important; saveTodos(); render(); };

    const del=document.createElement('button');
    del.className='delete-btn';
    del.textContent='âœ•';
    del.onclick=()=>{
      todos = todos.filter(x=>x!==t);
      saveTodos();
      render();
    };

    li.append(task,star,del);
    list.appendChild(li);
  });

  counter.textContent = `ë‚¨ì€ í•  ì¼: ${visible.filter(t=>!isCompletedOnDate(t,selectedDate)).length}ê°œ`;
}

/* ---------- ì¶”ê°€ ---------- */
function addTodo(){
  const text=input.value.trim();
  if(!text) return;

  todos.push({
    id: crypto.randomUUID(),
    text,
    date: selectedDate,
    repeat: repeatSelect.value,
    important:false,
    completedDates:[]
  });

  input.value='';
  repeatSelect.value='none';
  saveTodos();
  render();
}

/* ---------- ì´ë²¤íŠ¸ ---------- */
document.getElementById('addBtn').onclick = addTodo;
input.addEventListener('keydown',e=>{ if(e.key==='Enter') addTodo(); });

document.getElementById('clearCompletedBtn').onclick=()=>{
  todos = todos.filter(t =>
    !(matchesDate(t,selectedDate) && isCompletedOnDate(t,selectedDate))
  );
  saveTodos();
  render();
};

const overlay=document.getElementById('calendarOverlay');
document.getElementById('openCalendarBtn').onclick=()=>{
  calendarMonth=new Date(selectedDate);
  overlay.style.display='flex';
  renderMonthCalendar();
};

overlay.addEventListener('click',e=>{
  if(e.target===overlay) overlay.style.display='none';
});

document.getElementById('prevMonth').onclick=()=>{
  calendarMonth=new Date(calendarMonth.getFullYear(),calendarMonth.getMonth()-1,1);
  renderMonthCalendar();
};

document.getElementById('nextMonth').onclick=()=>{
  calendarMonth=new Date(calendarMonth.getFullYear(),calendarMonth.getMonth()+1,1);
  renderMonthCalendar();
};

/* ì´ˆê¸°í™” */
loadTodos();
renderDateStrip();
render();
</script>

</body>
</html>

