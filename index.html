<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ í•  ì¼</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#7bcfa3" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #eaf5ef;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      background: #f7fbf9;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    }

    h1 {
      text-align: center;
      margin: 0 0 8px;
      font-size: 22px;
    }

    .counter {
      text-align: center;
      font-size: 14px;
      color: #4f7f69;
      margin-bottom: 10px;
    }

    /* ë‚ ì§œ ìŠ¤íŠ¸ë¦½ */
    .date-strip {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      margin-bottom: 12px;
    }

    .date-btn {
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #cfe6d8;
      background: #fff;
      color: #2f7d5b;
      cursor: pointer;
      white-space: nowrap;
      font-size: 14px;
    }

    .date-btn.active {
      background: #7bcfa3;
      color: #fff;
      border-color: #7bcfa3;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    input[type="text"] {
      flex: 1;
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid #cfe6d8;
      font-size: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 12px 16px;
      background: #7bcfa3;
      color: #fff;
      font-size: 15px;
      cursor: pointer;
    }

    .clear-completed {
      width: 100%;
      margin-bottom: 12px;
      background: #dff2e8;
      color: #3f7f5f;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 12px;
      border-bottom: 1px solid #e3efe9;
    }

    .task {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .task span {
      font-size: 16px;
      word-break: break-word;
    }

    .completed span {
      text-decoration: line-through;
      color: #aaa;
    }

    .important span {
      color: #c89b00;
      font-weight: 600;
    }

    .star-btn {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #f2c94c;
    }

    .delete-btn {
      background: none;
      border: none;
      font-size: 18px;
      color: #ff5b5b;
      cursor: pointer;
    }

    .edit-input {
      flex: 1;
      font-size: 16px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #cfe6d8;
    }

    .hint {
      text-align: center;
      font-size: 12px;
      color: #6a8a7a;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="app">
    <h1>ğŸ“ ì˜¤ëŠ˜ì˜ í•  ì¼</h1>
    <div class="counter" id="counter">ë‚¨ì€ í•  ì¼: 0ê°œ</div>

    <!-- ë‚ ì§œ ì„ íƒ ë°” -->
    <div class="date-strip" id="dateStrip"></div>
    <input type="date" id="datePicker" style="display:none;" />

    <div class="input-row">
      <input id="todoInput" type="text" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" />
      <button id="addBtn">ì¶”ê°€</button>
    </div>

    <button class="clear-completed" id="clearCompletedBtn">
      ì™„ë£Œëœ í•­ëª© ëª¨ë‘ ì‚­ì œ
    </button>

    <ul id="todoList"></ul>

    <button id="installBtn" style="display:none;margin:12px auto 6px;">
      ğŸ“² ì•± ì„¤ì¹˜í•˜ê¸°
    </button>

    <div class="hint">ğŸ’¡ ë‚ ì§œ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‚ ì§œë³„ë¡œ í•  ì¼ì„ ê´€ë¦¬í•˜ì„¸ìš”</div>
  </div>

<script>
/* ---------------- ê¸°ë³¸ ì„¤ì • ---------------- */
const STORAGE_KEY = "todos_v1";

const input = document.getElementById("todoInput");
const list = document.getElementById("todoList");
const counter = document.getElementById("counter");
const datePicker = document.getElementById("datePicker");
const dateStrip = document.getElementById("dateStrip");
const addBtn = document.getElementById("addBtn");
const clearCompletedBtn = document.getElementById("clearCompletedBtn");

let todos = [];

const today = new Date().toISOString().split("T")[0];
datePicker.value = today;

/* ---------------- ë‚ ì§œ ìŠ¤íŠ¸ë¦½ ---------------- */
function formatLabel(dateStr) {
  const d = new Date(dateStr);
  return `${d.getMonth() + 1}/${d.getDate()}`;
}

function renderDateStrip() {
  dateStrip.innerHTML = "";
  const base = new Date();

  for (let i = 0; i < 7; i++) {
    const d = new Date(base);
    d.setDate(base.getDate() + i);
    const iso = d.toISOString().split("T")[0];

    const btn = document.createElement("button");
    btn.className = "date-btn" + (iso === datePicker.value ? " active" : "");
    btn.textContent = formatLabel(iso);

    btn.onclick = () => {
      datePicker.value = iso;
      render();
      renderDateStrip();
    };

    dateStrip.appendChild(btn);
  }
}

/* ---------------- ì €ì¥/ë¡œë“œ ---------------- */
function saveTodos() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
}

function loadTodos() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return;
  try {
    todos = JSON.parse(raw);
  } catch {
    todos = [];
  }
}

/* ---------------- ë Œë” ---------------- */
function getVisibleTodos() {
  return todos.filter(t => t.date === datePicker.value);
}

function updateCounter() {
  const count = getVisibleTodos().filter(t => !t.completed).length;
  counter.textContent = `ë‚¨ì€ í•  ì¼: ${count}ê°œ`;
}

function render() {
  list.innerHTML = "";

  getVisibleTodos().forEach(t => {
    const li = document.createElement("li");
    if (t.completed) li.classList.add("completed");
    if (t.important) li.classList.add("important");

    const task = document.createElement("div");
    task.className = "task";

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = t.completed;
    checkbox.onchange = () => {
      t.completed = checkbox.checked;
      saveTodos();
      render();
    };

    const span = document.createElement("span");
    span.textContent = t.text;

    span.ondblclick = () => editTodo(t);

    task.appendChild(checkbox);
    task.appendChild(span);

    const star = document.createElement("button");
    star.className = "star-btn";
    star.textContent = t.important ? "â˜…" : "â˜†";
    star.onclick = () => {
      t.important = !t.important;
      saveTodos();
      render();
    };

    const del = document.createElement("button");
    del.className = "delete-btn";
    del.textContent = "âœ•";
    del.onclick = () => {
      todos = todos.filter(x => x !== t);
      saveTodos();
      render();
    };

    li.append(task, star, del);
    list.appendChild(li);
  });

  updateCounter();
}

/* ---------------- ê¸°ëŠ¥ ---------------- */
function addTodo() {
  const text = input.value.trim();
  if (!text) return;

  todos.push({
    id: crypto.randomUUID(),
    text,
    completed: false,
    important: false,
    date: datePicker.value
  });

  input.value = "";
  saveTodos();
  render();
}

function editTodo(todo) {
  const newText = prompt("ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”", todo.text);
  if (!newText) return;
  todo.text = newText;
  saveTodos();
  render();
}

function clearCompleted() {
  todos = todos.filter(t => !(t.date === datePicker.value && t.completed));
  saveTodos();
  render();
}

/* ---------------- ì´ë²¤íŠ¸ ---------------- */
addBtn.onclick = addTodo;
input.addEventListener("keydown", e => e.key === "Enter" && addTodo());
clearCompletedBtn.onclick = clearCompleted;

/* ---------------- PWA ì„¤ì¹˜ ë²„íŠ¼ ---------------- */
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = "block";
});

installBtn.addEventListener("click", async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
  installBtn.style.display = "none";
});

/* ---------------- ì´ˆê¸° ì‹¤í–‰ ---------------- */
loadTodos();
renderDateStrip();
render();

/* ì„œë¹„ìŠ¤ ì›Œì»¤ */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js");
}
</script>
</body>
</html>
